version: '3.8'

services:
    DockerProxmoxBackup:
        # hostname: "{{.Node.Hostname}}"
        hostname: devtools
        # image: ghcr.io/lyze237/dockerproxmoxbackup:main
        image: dockerproxmoxbackup
        build:
            context: .
        secrets:
            - proxmox_password_secret
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
        environment:
            Proxmox__PasswordFile: "/run/secrets/proxmox_password_secret"
            Proxmox__Repository: "bdd@pbs@backups.chirps.cafe:backups"
            ProxmoX__Namespace: "files"

    PostgresExample:
        image: postgres
        environment:
            POSTGRES_PASSWORD: password

    OtherPostgresExample:
        image: postgres
        labels:
            backup.name: other
        environment:
            POSTGRES_PASSWORD: password

secrets:
    proxmox_password_secret:
        file: proxmox_password.secret
